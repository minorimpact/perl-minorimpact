<!-- TEMPLATE:default.header_javascript -->
<script src="/jquery-2.1.4.js"></script>
<script src="/jquery-ui-1.11.4/jquery-ui.js"></script>

<script>
    \$(function () {
        \$( "#reference_add-dialog" ).dialog({
            autoOpen: false,
            height: 350,
            width: 375,
            modal: true,
            buttons: {
                "Create Reference": function() {
                    var data = \$(this).data('data');
                    var object_text_id = \$(this).data('object_text_id');
                    var object_id = \$("#object_id").val();
                    var url = "[% script_name %]?a=add_reference&object_text_id=" + object_text_id + "&object_id=" + object_id + "&data=" + encodeURI(data);
                    //alert(url);
                    \$.get(url, function(data, status){
                        \$( "#reference_add-dialog" ).dialog("close");
                        window.location.reload(true);
                    });
                },
                Cancel: function() {
                    \$( this ).dialog( "close" );
                }
        }});
        \$("#object_type_id").html('');
        \$("#object_type_id").change(function() {
            reloadObjects();
        });
        \$.getJSON("[% script_name %]?a=object_types",function(data) {
            for (var i=0; i<data.length; i++) {
                var object_type = data[i];
                var select = "<option value=" + object_type.id;
                select = select + ">" + object_type.name + "</option>";
                \$("#object_type_id").append(select);
            }
        });

        \$("a.paginate").click(function(e) {
            //alert(\$(this).attr('href'));
            e.preventDefault();
            var href = \$(this).attr('href');
            var tabs = \$("#tabs");
            var currentTabIndex = tabs.tabs("option", "active");
            //var tab = \$(tabs.data('uiTabs').tabs[currentTabIndex]);
            var tab = \$(tabs.data()['ui-tabs'].tabs[currentTabIndex]);
            tab.find('.ui-tabs-anchor').attr('href', href);
            // If cached initially. Remove cache then
            tab.data( "loaded", false);
            tabs.tabs("load", currentTabIndex);
        });
    });

    function reloadObjects() {
        \$("#object_id").html('');
        var parent_id = \$("#reference_add-dialog").data('parent_id', parent_id);
        \$.getJSON("[% script_name %]?a=list&format=json&type_id=" + \$("#object_type_id").val() ,function(data) {
            for (var i=0; i<data.length; i++) {
                var object = data[i];
                var select = "<option value=" + object.id;
                select = select + ">" + object.name + "</option>";
                \$("#object_id").append(select);
            }
        });
    }

    function getSelectedText(object_text_id) {
        var parent_id = '';
        var text = "";
        if (window.getSelection && \$('#reference_add-dialog').dialog('isOpen') ==  false) {
            text = window.getSelection().toString();
            if (text.length == 0) {
                return;
            }
            \$("#reference_add-dialog").data('object_text_id',object_text_id).data('parent_id', parent_id).data('data', text).dialog("open");
            \$("#reference_add-text").html(text);
            \$("#object_id").html('');
            \$.getJSON("index.cgi?a=list&format=json&type_id=" + \$("#object_type_id").val(), function(data) {
                for (var i=0; i<data.length; i++) {
                    var object = data[i];
                    var select = "<option value=" + object.id;
                    select = select + ">" + object.name + "</option>";
                    \$("#object_id").append(select);
                }
            });
        }
    }

    // Duplicates the row the control is in and marks it so it
    // won't get duplicated again.  Used to dynamically add array fields
    // to forms.
    function duplicateRow(o) {
        var \$tr = \$(o).closest("tr");
        if (\$tr.data('duped') == 1 || \$(o).val() == '' || \$(o).val() == ' ') {
            return;
        }
        var \$clone = \$tr.clone();
        \$tr.after(\$clone);
        \$tr.data('duped', 1);
        \$clone.find("input:text").val(' ');
        \$clone.find("td.fieldname").html('');
    }   

    function openCollectionsDD() {
        var x = document.getElementById("collectionsDD");
        if (x.className.indexOf("w3-show") == -1) {
            x.className += " w3-show";
        } else { 
            x.className = x.className.replace(" w3-show", "");
        }
    }
    function openTagsDD() {
        var x = document.getElementById("tagsDD");
        if (x.className.indexOf("w3-show") == -1) {
            x.className += " w3-show";
        } else { 
            x.className = x.className.replace(" w3-show", "");
        }
    }
    [% IF 0 and search %]
        document.getElementById("save_button").disabled = false;
    [% ELSIF 0 %]
        document.getElementById("save_button").disabled = true;
    [% END %]
    function submitForm(form) {
        var form = document.getElementById('search_form');
        if (form.search.value.length) {
            var save_name = prompt ("Save Name");
            form.a.value = 'save_search';
            form.save_name.value = save_name;
        }
        form.submit();
    }
    [% INCLUDE header_javascript_site %]
</script>
